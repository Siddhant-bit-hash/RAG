<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s8 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s9 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s10 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s13 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s14 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s15 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Chat with PDF - Gemini Edition</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">@import</span><span class="s4"> </span><span class="s5">url</span><span class="s8">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s9">'Inter'</span><span class="s8">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #f3f4f6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-container::-webkit-scrollbar</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s10">8px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-container::-webkit-scrollbar-track</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #f1f1f1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-container::-webkit-scrollbar-thumb</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #888</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">4px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-container::-webkit-scrollbar-thumb:hover</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #555</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.prose</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s10">100%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.user-message</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #dbeafe</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s1"> </span><span class="s5">flex-end</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.bot-message</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #ffffff</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s1"> </span><span class="s5">flex-start</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.message-bubble</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s10">80%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">12px</span><span class="s1"> </span><span class="s10">16px</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">18px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">word-wrap:</span><span class="s1"> </span><span class="s5">break-word</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s10">0</span><span class="s1"> </span><span class="s10">1px</span><span class="s1"> </span><span class="s10">3px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s10">0</span><span class="s8">,</span><span class="s10">0</span><span class="s8">,</span><span class="s10">0</span><span class="s8">,</span><span class="s10">0.05</span><span class="s5">)</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.loader</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s10">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #f3f3f3</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-top:</span><span class="s1"> </span><span class="s10">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #3498db</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s10">50%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s10">24px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s10">24px</span><span class="s8">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">spin</span><span class="s4"> </span><span class="s10">1s</span><span class="s4"> </span><span class="s1">linear</span><span class="s4"> </span><span class="s1">infinite</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-right:</span><span class="s1"> </span><span class="s10">12px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">@keyframes</span><span class="s1"> </span><span class="s5">spin</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">0%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s10">0deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">100%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s10">360deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col h-screen antialiased text-gray-800"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-shrink-0 bg-white p-4 shadow-md z-10"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-w-4xl mx-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-center text-gray-700"</span><span class="s3">&gt;</span><span class="s4">Chat with PDF (Gemini Edition)</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-sm text-gray-500 mt-1"</span><span class="s3">&gt;</span><span class="s1">Upload a PDF and ask questions about its content.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow flex flex-col md:flex-row max-w-7xl mx-auto w-full p-4 gap-4 overflow-hidden"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Left Panel: Controls --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full md:w-1/3 flex flex-col gap-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white p-5 rounded-lg shadow"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-3 text-gray-700"</span><span class="s3">&gt;</span><span class="s4">1. Set API Key</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"password"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"apiKey"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"Enter your Google AI API Key"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500 mt-2"</span><span class="s3">&gt;</span><span class="s1">Your key is used only for API calls and is not stored.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white p-5 rounded-lg shadow"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-3 text-gray-700"</span><span class="s3">&gt;</span><span class="s4">2. Upload PDF</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center justify-center w-full"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"pdfUpload"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col items-center justify-center pt-5 pb-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-8 h-8 mb-2 text-gray-500"</span><span class="s4"> </span><span class="s2">aria-hidden</span><span class="s3">=</span><span class="s1">"true"</span><span class="s4"> </span><span class="s2">xmlns</span><span class="s3">=</span><span class="s1">"http://www.w3.org/2000/svg"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 20 16"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                                </span></span><span class="s3">&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s4"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">d</span><span class="s3">=</span><span class="s1">"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"</span><span class="s3">/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mb-1 text-sm text-gray-500"</span><span class="s3">&gt;&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"font-semibold"</span><span class="s3">&gt;</span><span class="s1">Click to upload</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> or drag and drop</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdfUpload"</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">".pdf"</span><span class="s4"> </span><span class="s3">/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdfStatus"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm text-center text-gray-600 mt-3"</span><span class="s3">&gt;</span><span class="s4">No file selected.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"processing-indicator"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden items-center justify-center text-gray-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"loader"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1">Processing PDF...</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Right Panel: Chat Interface --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full md:w-2/3 flex flex-col bg-white rounded-lg shadow"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chat-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow p-6 overflow-y-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col gap-4"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Chat messages will be appended here --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                     </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bot-message message-bubble"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"prose"</span><span class="s3">&gt;</span><span class="s1">Hello! Please provide your API key and upload a PDF to get started.</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Message Input --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 bg-gray-50 border-t border-gray-200 rounded-b-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"relative flex"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"userInput"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"Ask a question about the PDF..."</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-3 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"</span><span class="s4"> </span><span class="s2">disabled</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"sendButton"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute right-1 top-1/2 -translate-y-1/2 p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-300"</span><span class="s4"> </span><span class="s2">disabled</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">xmlns</span><span class="s3">=</span><span class="s1">"http://www.w3.org/2000/svg"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"h-6 w-6"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 24 24"</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s1">stroke-linecap</span><span class="s3">=</span><span class="s5">"round"</span><span class="s4"> </span><span class="s1">stroke-linejoin</span><span class="s3">=</span><span class="s5">"round"</span><span class="s4"> </span><span class="s1">stroke-width</span><span class="s3">=</span><span class="s5">"2"</span><span class="s4"> </span><span class="s1">d</span><span class="s3">=</span><span class="s5">"M5 12h14M12 5l7 7-7 7"</span><span class="s4"> </span><span class="s3">/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> pdfjsLib </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">[</span><span class="s9">'pdfjs-dist/build/pdf'</span><span class="s8">];</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span>pdfjsLib</span><span class="s8">.</span><span class="s12">GlobalWorkerOptions</span><span class="s8">.</span><span class="s4">workerSrc </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> apiKeyInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'apiKey'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> pdfUploadInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'pdfUpload'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> pdfStatus </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'pdfStatus'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> userInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'userInput'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> sendButton </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'sendButton'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> chatContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'chat-container'</span><span class="s8">).</span><span class="s1">firstElementChild</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> processingIndicator </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'processing-indicator'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> pdfText </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> textChunks </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> chatHistory </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Event Listeners ---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>pdfUploadInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'change'</span><span class="s8">,</span><span class="s1"> handlePdfUpload</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>sendButton</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> handleSendMessage</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>userInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'keydown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">key </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Enter'</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> </span><span class="s8">!</span><span class="s1">e</span><span class="s8">.</span><span class="s1">shiftKey</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>e</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>handleSendMessage</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Core Functions ---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handlePdfUpload</span><span class="s8">(</span><span class="s1">event</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> file </span><span class="s8">=</span><span class="s1"> event</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">files</span><span class="s8">[</span><span class="s13">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">file </span><span class="s8">||</span><span class="s1"> file</span><span class="s8">.</span><span class="s1">type </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'application/pdf'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>pdfStatus</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'Please select a valid PDF file.'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pdfStatus</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`Loading "</span><span class="s8">${</span><span class="s1">file</span><span class="s8">.</span><span class="s1">name</span><span class="s8">}</span><span class="s9">"...`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>processingIndicator</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>processingIndicator</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'flex'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> reader </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">FileReader</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>reader</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s7">async</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> typedarray </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Uint8Array</span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">result</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> pdf </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> pdfjsLib</span><span class="s8">.</span><span class="s1">getDocument</span><span class="s8">({</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> typedarray </span><span class="s8">}).</span><span class="s1">promise</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">let</span><span class="s1"> fullText </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">for</span><span class="s1"> </span><span class="s8">(</span><span class="s7">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s13">1</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;=</span><span class="s1"> pdf</span><span class="s8">.</span><span class="s1">numPages</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> page </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> pdf</span><span class="s8">.</span><span class="s1">getPage</span><span class="s8">(</span><span class="s1">i</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> page</span><span class="s8">.</span><span class="s1">getTextContent</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>fullText </span><span class="s8">+=</span><span class="s1"> textContent</span><span class="s8">.</span><span class="s1">items</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">str</span><span class="s8">).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">' '</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s9">'\n'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pdfText </span><span class="s8">=</span><span class="s1"> fullText</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>textChunks </span><span class="s8">=</span><span class="s1"> splitTextIntoChunks</span><span class="s8">(</span><span class="s1">pdfText</span><span class="s8">,</span><span class="s1"> </span><span class="s13">2000</span><span class="s8">);</span><span class="s1"> </span><span class="s14">// Split into chunks of 2000 chars</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pdfStatus</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`✅ Ready: "</span><span class="s8">${</span><span class="s1">file</span><span class="s8">.</span><span class="s1">name</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>userInput</span><span class="s8">.</span><span class="s1">disabled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sendButton</span><span class="s8">.</span><span class="s1">disabled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>addMessageToChat</span><span class="s8">(</span><span class="s1">'bot'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'PDF processed successfully! You can now ask questions.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>reader</span><span class="s8">.</span><span class="s1">readAsArrayBuffer</span><span class="s8">(</span><span class="s1">file</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">'Error processing PDF:'</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>pdfStatus</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'Error processing PDF.'</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s8">(</span><span class="s1">'bot'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Sorry, there was an error processing the PDF. Please try another file.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">finally</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>processingIndicator</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>processingIndicator</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'flex'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleSendMessage</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> userQuery </span><span class="s8">=</span><span class="s1"> userInput</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> apiKey </span><span class="s8">=</span><span class="s1"> apiKeyInput</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">userQuery</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">apiKey</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s8">(</span><span class="s1">'bot'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Please enter your API key before sending a message.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">pdfText</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s8">(</span><span class="s1">'bot'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Please upload a PDF file first.'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>addMessageToChat</span><span class="s8">(</span><span class="s9">'user'</span><span class="s8">,</span><span class="s1"> userQuery</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>userInput</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>showLoadingIndicator</span><span class="s8">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Find relevant context from the PDF</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> context </span><span class="s8">=</span><span class="s1"> findRelevantContext</span><span class="s8">(</span><span class="s1">userQuery</span><span class="s8">,</span><span class="s1"> textChunks</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Construct the prompt</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> prompt </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>Based on the following context from a PDF document and our chat history, please provide a helpful and concise answer to the user's question.</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>CONTEXT FROM PDF:</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s4">context</span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>CHAT HISTORY:</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                    </span></span><span class="s8">${</span><span class="s1">formatChatHistory</span><span class="s8">(</span><span class="s1">chatHistory</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>USER'S QUESTION:</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>"</span><span class="s8">${</span><span class="s4">userQuery</span><span class="s8">}</span><span class="s1">"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>ANSWER:</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 3. Call Gemini API</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s4"> model </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'gemini-2.5-flash-preview-09-2025'</span><span class="s8">;</span><span class="s4"> </span><span class="s14">// Using the specified model</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s4"> apiUrl </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`https://generativelanguage.googleapis.com/v1beta/models/</span><span class="s8">${</span><span class="s4">model</span><span class="s8">}</span><span class="s1">:generateContent?key=</span><span class="s8">${</span><span class="s4">apiKey</span><span class="s8">}</span><span class="s1">`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> payload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>contents</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> parts</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> prompt </span><span class="s8">}]</span><span class="s1"> </span><span class="s8">}],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> response </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> fetch</span><span class="s8">(</span><span class="s1">apiUrl</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>method</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'POST'</span><span class="s8">,</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span>headers</span><span class="s8">:</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">'Content-Type'</span><span class="s8">:</span><span class="s4"> </span><span class="s1">'application/json'</span><span class="s4"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>body</span><span class="s8">:</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">stringify</span><span class="s8">(</span><span class="s1">payload</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">response</span><span class="s8">.</span><span class="s1">ok</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> errorData </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> response</span><span class="s8">.</span><span class="s1">json</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">throw</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Error</span><span class="s8">(</span><span class="s1">errorData</span><span class="s8">.</span><span class="s1">error</span><span class="s8">.</span><span class="s1">message </span><span class="s8">||</span><span class="s1"> </span><span class="s9">`API request failed with status </span><span class="s8">${</span><span class="s1">response</span><span class="s8">.</span><span class="s1">status</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> result </span><span class="s8">=</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> response</span><span class="s8">.</span><span class="s1">json</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> botResponse </span><span class="s8">=</span><span class="s1"> result</span><span class="s8">.</span><span class="s1">candidates</span><span class="s8">[</span><span class="s13">0</span><span class="s8">].</span><span class="s1">content</span><span class="s8">.</span><span class="s1">parts</span><span class="s8">[</span><span class="s13">0</span><span class="s8">].</span><span class="s1">text</span><span class="s8">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>hideLoadingIndicator</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s8">(</span><span class="s9">'bot'</span><span class="s8">,</span><span class="s1"> botResponse</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Update chat history</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chatHistory</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> role</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'user'</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> userQuery </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chatHistory</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> role</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'bot'</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> botResponse </span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">'Error calling Gemini API:'</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>hideLoadingIndicator</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addMessageToChat</span><span class="s8">(</span><span class="s9">'bot'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`Sorry, an error occurred: </span><span class="s8">${</span><span class="s1">error</span><span class="s8">.</span><span class="s1">message</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Helper Functions ---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> addMessageToChat</span><span class="s8">(</span><span class="s1">sender</span><span class="s8">,</span><span class="s1"> message</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> messageWrapper </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>messageWrapper</span><span class="s8">.</span><span class="s4">className </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`message-bubble </span><span class="s8">${</span><span class="s4">sender </span><span class="s8">===</span><span class="s4"> </span><span class="s1">'user'</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'user-message'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'bot-message'</span><span class="s8">}</span><span class="s1">`</span><span class="s8">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> proseDiv </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>proseDiv</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'prose'</span><span class="s8">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// A simple way to format basic markdown like **bold** and *italic*</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> formattedMessage </span><span class="s8">=</span><span class="s1"> message</span><span class="s8">.</span><span class="s1">replace</span><span class="s8">(</span><span class="s15">/\*\*(.*?)\*\*/</span><span class="s7">g</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'&lt;strong&gt;$1&lt;/strong&gt;'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>formattedMessage </span><span class="s8">=</span><span class="s1"> formattedMessage</span><span class="s8">.</span><span class="s1">replace</span><span class="s8">(</span><span class="s15">/\*(.*?)\*/</span><span class="s7">g</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'&lt;em&gt;$1&lt;/em&gt;'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>formattedMessage </span><span class="s8">=</span><span class="s1"> formattedMessage</span><span class="s8">.</span><span class="s1">replace</span><span class="s8">(</span><span class="s15">/\n/</span><span class="s7">g</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'&lt;br&gt;'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>proseDiv</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> formattedMessage</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageWrapper</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">proseDiv</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">messageWrapper</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s8">.</span><span class="s1">parentElement</span><span class="s8">.</span><span class="s1">scrollTop </span><span class="s8">=</span><span class="s1"> chatContainer</span><span class="s8">.</span><span class="s1">parentElement</span><span class="s8">.</span><span class="s1">scrollHeight</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> showLoadingIndicator</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> loadingBubble </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadingBubble</span><span class="s8">.</span><span class="s1">id </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'loading-indicator'</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>loadingBubble</span><span class="s8">.</span><span class="s4">className </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'bot-message message-bubble flex items-center'</span><span class="s8">;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span>loadingBubble</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`&lt;div class="loader"&gt;&lt;/div&gt;&lt;span&gt;Thinking...&lt;/span&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">loadingBubble</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatContainer</span><span class="s8">.</span><span class="s1">parentElement</span><span class="s8">.</span><span class="s1">scrollTop </span><span class="s8">=</span><span class="s1"> chatContainer</span><span class="s8">.</span><span class="s1">parentElement</span><span class="s8">.</span><span class="s1">scrollHeight</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> hideLoadingIndicator</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> indicator </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'loading-indicator'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">indicator</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>indicator</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> splitTextIntoChunks</span><span class="s8">(</span><span class="s1">text</span><span class="s8">,</span><span class="s1"> chunkSize</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> chunks </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">for</span><span class="s1"> </span><span class="s8">(</span><span class="s7">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;</span><span class="s1"> text</span><span class="s8">.</span><span class="s1">length</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">+=</span><span class="s1"> chunkSize</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chunks</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">text</span><span class="s8">.</span><span class="s1">substring</span><span class="s8">(</span><span class="s1">i</span><span class="s8">,</span><span class="s1"> i </span><span class="s8">+</span><span class="s1"> chunkSize</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> chunks</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> findRelevantContext</span><span class="s8">(</span><span class="s1">query</span><span class="s8">,</span><span class="s1"> chunks</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// This is a simple keyword-based retrieval.<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// A more advanced implementation would use embeddings and vector similarity.</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> queryWords </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Set</span><span class="s8">(</span><span class="s1">query</span><span class="s8">.</span><span class="s1">toLowerCase</span><span class="s8">().</span><span class="s1">split</span><span class="s8">(</span><span class="s15">/\s+/</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> scoredChunks </span><span class="s8">=</span><span class="s1"> chunks</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">chunk </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> chunkWords </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Set</span><span class="s8">(</span><span class="s1">chunk</span><span class="s8">.</span><span class="s1">toLowerCase</span><span class="s8">().</span><span class="s1">split</span><span class="s8">(</span><span class="s15">/\s+/</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> score </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">for</span><span class="s1"> </span><span class="s8">(</span><span class="s7">const</span><span class="s1"> word </span><span class="s7">of</span><span class="s1"> queryWords</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">chunkWords</span><span class="s8">.</span><span class="s1">has</span><span class="s8">(</span><span class="s1">word</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>score</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> chunk</span><span class="s8">,</span><span class="s1"> score </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>scoredChunks</span><span class="s8">.</span><span class="s1">sort</span><span class="s8">((</span><span class="s1">a</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">score </span><span class="s8">-</span><span class="s1"> a</span><span class="s8">.</span><span class="s1">score</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Return the top 2 most relevant chunks</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> scoredChunks</span><span class="s8">.</span><span class="s1">slice</span><span class="s8">(</span><span class="s13">0</span><span class="s8">,</span><span class="s1"> </span><span class="s13">2</span><span class="s8">).</span><span class="s1">map</span><span class="s8">(</span><span class="s1">item </span><span class="s8">=&gt;</span><span class="s1"> item</span><span class="s8">.</span><span class="s1">chunk</span><span class="s8">).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">'\n\n---\n\n'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> formatChatHistory</span><span class="s8">(</span><span class="s1">history</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">history</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s9">"No previous conversation."</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Get the last 4 messages (2 turns)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> history</span><span class="s8">.</span><span class="s1">slice</span><span class="s8">(-</span><span class="s13">4</span><span class="s8">).</span><span class="s1">map</span><span class="s8">(</span><span class="s1">msg </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s9">`</span><span class="s8">${</span><span class="s1">msg</span><span class="s8">.</span><span class="s1">role </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'user'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'User'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'Bot'</span><span class="s8">}</span><span class="s9">: </span><span class="s8">${</span><span class="s1">msg</span><span class="s8">.</span><span class="s1">text</span><span class="s8">}</span><span class="s9">`</span><span class="s8">).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">'\n'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
</body>
</html>
